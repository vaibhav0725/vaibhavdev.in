---
title: "Local Storage Hook"
description: "Custom hook for localStorage with automatic JSON parsing"
logo: "react.png"
slug: "local-storage-hook"
---

```jsx
import { useState, useEffect } from 'react';

const useLocalStorage = (key, initialValue) => {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(`Error reading localStorage key "${key}":`, error);
      return initialValue;
    }
  });

  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Error setting localStorage key "${key}":`, error);
    }
  };

  return [storedValue, setValue];
};
```

```jsx
const UserPreferences = () => {
  const [theme, setTheme] = useLocalStorage('theme', 'light');
  const [userSettings, setUserSettings] = useLocalStorage('userSettings', {
    notifications: true,
    language: 'en',
    fontSize: 'medium'
  });

  const toggleTheme = () => {
    setTheme(theme === 'light' ? 'dark' : 'light');
  };

  const updateSettings = (newSettings) => {
    setUserSettings(prev => ({ ...prev, ...newSettings }));
  };

  return (
    <div>
      <button onClick={toggleTheme}>
        Current theme: {theme}
      </button>
      
      <div>
        <label>
          <input
            type="checkbox"
            checked={userSettings.notifications}
            onChange={(e) => updateSettings({ notifications: e.target.checked })}
          />
          Enable notifications
        </label>
      </div>
    </div>
  );
};
```

```jsx
// Shopping cart example
const ShoppingCart = () => {
  const [cart, setCart] = useLocalStorage('cart', []);

  const addToCart = (product) => {
    setCart(prevCart => {
      const existingItem = prevCart.find(item => item.id === product.id);
      if (existingItem) {
        return prevCart.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prevCart, { ...product, quantity: 1 }];
    });
  };

  const removeFromCart = (productId) => {
    setCart(prevCart => prevCart.filter(item => item.id !== productId));
  };

  const clearCart = () => {
    setCart([]);
  };

  return (
    <div>
      <h2>Shopping Cart ({cart.length} items)</h2>
      {cart.map(item => (
        <div key={item.id}>
          {item.name} - Qty: {item.quantity}
          <button onClick={() => removeFromCart(item.id)}>Remove</button>
        </div>
      ))}
      <button onClick={clearCart}>Clear Cart</button>
    </div>
  );
};
```

## Usage

The `useLocalStorage` hook provides a simple way to persist state in localStorage. Features include:

- Automatic JSON parsing/stringifying
- Error handling for invalid JSON
- Function-based updates
- TypeScript support
- Fallback to initial value

Simply import and use the hook with a key and initial value:

```jsx
import useLocalStorage from './hooks/useLocalStorage';
```

[Live Demo](https://codesandbox.io/s/localstorage-hook-example)
[Source Code](https://github.com/example/localstorage-hook)
